---
import { Image } from "astro:assets";
import advertisingSvg from "@assets/images/services/advertising.svg?raw";
import designSvg from "@assets/images/services/creative-designer-doing-multitasking.svg?raw";
import mobileSvg from "@assets/images/services/mobile-app-ui-ux-design.svg?raw";
import seoSvg from "@assets/images/services/seo-link-building.svg?raw";
import websiteSvg from "@assets/images/services/website-ui-ux-development.svg?raw";
import { getLangFromUrl, useTranslations, useTranslatedPath } from "@i18n/utils";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
const translatePath = useTranslatedPath(lang);

const { class: className } = Astro.props;

const points = [
	{
		title: t("prologue.title"),
		content: t("prologue.content"),
		image: websiteSvg,
	},
	{
		title: t("apps.title"),
		content: t("apps.content"),
		image: mobileSvg,
	},
	{
		title: t("uiux.title"),
		content: t("uiux.content"),
		image: designSvg,
	},
	{
		title: t("seo.title"),
		content: t("seo.content"),
		image: seoSvg,
	},
	{
		title: t("advertising.title"),
		content: t("advertising.content"),
		image: advertisingSvg,
	},
];
---

<section id="services" class:list={["section relative py-20 lg:py-32", className]}>
	<div class="mx-auto max-w-7xl px-8 col-span-12">
		<!-- Section heading with decorative element -->
		<div class="mb-16 text-center">
			<h2 class="section-title pb-4">What is this?</h2>
			<div class="mx-auto h-1 w-16 bg-gradient-to-r from-campfire-500 to-transparent"></div>
		</div>

		<div class="wrapper relative">
			{
				points.map(({ title, content, image }, index) => (
					<div class="mb-24 flex flex-col items-center lg:items-start lg:flex-row gap-12">
						<!-- Create parchment-like background for each service -->
						<div class="relative w-full max-w-sm parchment p-6 lg:p-8">
							<div class="absolute -inset-px bg-gradient-to-tr from-campfire-300/20 to-transparent rounded-lg"></div>
							<div class="relative">
								<Fragment set:html={image} class="text-campfire-700 w-12 h-12 mb-4" />
								<h3 class="font-display text-2xl font-bold text-campfire-700 mb-4">{title}</h3>
								<p class="text-night-800" set:html={content} />
							</div>
							
							<!-- Add decorative corner flourishes -->
							<div class="absolute top-0 left-0 w-8 h-8 border-t-2 border-l-2 border-campfire-500/30 rounded-tl-lg"></div>
							<div class="absolute top-0 right-0 w-8 h-8 border-t-2 border-r-2 border-campfire-500/30 rounded-tr-lg"></div>
							<div class="absolute bottom-0 left-0 w-8 h-8 border-b-2 border-l-2 border-campfire-500/30 rounded-bl-lg"></div>
							<div class="absolute bottom-0 right-0 w-8 h-8 border-b-2 border-r-2 border-campfire-500/30 rounded-br-lg"></div>
						</div>
						
						<!-- Add firefly accent to alternate sides -->
						<div class={`firefly absolute ${index % 2 === 0 ? '-left-2' : '-right-2'} top-1/2`}></div>
					</div>
				))
			}
		</div>
	</div>
</section>

<script>
	import { gsap } from "gsap";
	import { ScrollTrigger } from "gsap/ScrollTrigger";
	import { MorphSVGPlugin } from "gsap/MorphSVGPlugin";

	gsap.registerPlugin(ScrollTrigger, MorphSVGPlugin);

	function init() {
		var points = gsap.utils.toArray(".point") as gsap.DOMTarget[];
		var indicators = gsap.utils.toArray(".indicator") as gsap.DOMTarget[];

		var height = 100 * points.length;

		gsap.set(".indicators", { display: "flex" });

		var tl = gsap.timeline({
			duration: points.length,
			scrollTrigger: {
				trigger: "#services",
				start: "top center",
				end: "+=" + height + "%",
				scrub: 0.5,
				markers: false,
				id: "points",
				immediateRender: false,
			},
		});

		var pinner = gsap.timeline({
			scrollTrigger: {
				trigger: ".services-section .wrapper",
				start: "top top",
				end: "+=" + height + "%",
				scrub: 0.5,
				pin: ".services-section .wrapper",
				pinSpacing: true,
				id: "pinning",
				markers: false,
				snap: {
					snapTo: [0, 0.25, 0.5, 0.7, 0.9], // snap to the closest label in the timeline
					duration: { min: 0.1, max: 0.1 }, // the snap animation should be at least 0.2 seconds, but no more than 3 seconds (determined by velocity)
					delay: 1, // wait 1 seconds from the last scroll event before doing the snapping
					inertia: false,
					directional: false,
					ease: "power1.inOut", // the ease of the snap animation ("power3" by default)
				},
			},
		});

		points.forEach(function (elem, i) {
			gsap.set(elem, { position: "absolute", top: 0 });

			// https://codepen.io/zank/pen/oNVjYMM?editors=0010
			tl.to(indicators[i], { backgroundColor: "white", duration: 0.25 }, i);
			tl.from((elem as HTMLElement).querySelector("svg"), { autoAlpha: 0 }, i);
			tl.from((elem as HTMLElement).querySelector("article"), { autoAlpha: 0, translateY: 100 }, i);

			if (i != points.length - 1) {
				tl.to(indicators[i], { backgroundColor: "#333333", duration: 0.25 }, i + 0.75);
				tl.to((elem as HTMLElement).querySelector("article"), { autoAlpha: 0, translateY: -100 }, i + 0.75);
				tl.to((elem as HTMLElement).querySelector("svg"), { autoAlpha: 0 }, i + 0.75);
			}
		});
	}

	document.removeEventListener("DOMContentLoaded", init); // astro:page-load
	document.addEventListener("DOMContentLoaded", init); // astro:page-load
</script>
