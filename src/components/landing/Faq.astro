---
import { getLangFromUrl, useTranslations, useTranslatedPath } from "@i18n/utils";

const { class: className } = Astro.props;

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
const translatePath = useTranslatedPath(lang);

const faqs = [
	{
		question: t("faqs.question1"),
		answer: t("faqs.answer1"),
	},
	{
		question: t("faqs.question2"),
		answer: t("faqs.answer2"),
	},
	{
		question: t("faqs.question3"),
		answer: t("faqs.answer3"),
	},
	{
		question: t("faqs.question4"),
		answer: t("faqs.answer4"),
	},
	{
		question: t("faqs.question5"),
		answer: t("faqs.answer5"),
	},
	{
		question: t("faqs.question6"),
		answer: t("faqs.answer6"),
	},
];
---

<section id="faq" class="section col-span-12 relative py-20 lg:py-32">
	<div class="relative col-span-12 z-10 mx-auto max-w-7xl px-8">
		<!-- Section heading with decorative element -->
		<div class="mb-16 text-center">
			<h2 class="section-title pb-4">{t("faq.title")}</h2>
			<div class="mx-auto h-1 w-16 bg-gradient-to-r from-campfire-500 to-transparent"></div>
		</div>

		<div class="faq-list mx-auto max-w-3xl space-y-6">
			{
				faqs.map(({ question, answer }) => (
					<details class="group parchment">
						<summary class="flex cursor-pointer items-center justify-between px-6 py-4 font-display text-lg font-medium text-campfire-700">
							<span>{question}</span>
							<svg 
								xmlns="http://www.w3.org/2000/svg" 
								class="h-5 w-5 transform transition-transform duration-300 group-open:rotate-180" 
								viewBox="0 0 20 20" 
								fill="currentColor"
							>
								<path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
							</svg>
						</summary>
						<div class="px-6 pb-6 pt-2">
							<p class="text-night-800">{answer}</p>
						</div>
					</details>
				))
			}
		</div>
	</div>
	
	<!-- Add decorative elements -->
	<div class="absolute bottom-0 left-0 right-0 h-32 bg-gradient-to-t from-night-900/80 to-transparent"></div>
	
	<!-- Add some horizontal string lights at the top of the section -->
	<div class="absolute top-0 left-0 right-0 h-10 overflow-hidden">
		<div class="string-lights-horizontal"></div>
	</div>
</section>

<style>
	/* Style the FAQ details/summary elements */
	summary {
		list-style: none;
	}
	
	summary::-webkit-details-marker {
		display: none;
	}
	
	details {
		transition: all 0.3s ease;
	}
	
	details[open] {
		box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
	}
</style>

<style is:global>
	.faq-section {
		--faq-clip: 0;
		--faq-radius: 0;
		clip-path: inset(var(--faq-clip) round var(--faq-radius));
		margin-top: -1px; /* Fix weird clip path behavior */
	}
</style>

<script>
	import { gsap } from "gsap";
	import { ScrollTrigger } from "gsap/ScrollTrigger";
	import { DrawSVGPlugin } from "gsap/DrawSVGPlugin";

	gsap.registerPlugin(ScrollTrigger, DrawSVGPlugin);

	function init() {
		gsap.to("#faq", {
			scrollTrigger: {
				trigger: "#faq",
				start: "bottom center",
				end: "bottom top",
				scrub: 1,
				markers: false,
			},
			"--faq-clip": "2vw",
			"--faq-radius": "5rem",
		});

		const linePath = document.querySelector("#faq-more-question-path");

		gsap.set(linePath, { drawSVG: 0 });

		let otherQTl = gsap
			.timeline({
				scrollTrigger: {
					trigger: ".faq-more-questions",
					start: "center 90%",
					end: "center top",
					markers: false,
					toggleActions: "play none none reverse",
				},
			})
			.to(".faq-more-questions .other-question-title", {
				opacity: 1,
				duration: 0.5,
			})
			.to(
				linePath,
				{
					drawSVG: "100%",
					duration: 2,
				},
				"<",
			)
			.to(
				".faq-contact-us-button",
				{
					opacity: 1,
				},
				">-=1.5",
			);
	}

	document.removeEventListener("DOMContentLoaded", init); // astro:page-load
	document.addEventListener("DOMContentLoaded", init); // astro:page-load
</script>
