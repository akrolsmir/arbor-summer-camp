---
import { getCollection } from "astro:content";
import { Image } from "astro:assets";
import type { AstroSeoProps } from "@astrolib/seo";
import BaseLayout from "@layouts/BaseLayout.astro";
import BranchSchedule from "@components/branches/BranchSchedule.astro";

export async function getStaticPaths() {
	const branchEntries = await getCollection("branches");

	return branchEntries
		.map((entry) => {
			const [lang, ...slug] = entry.slug.split("/");
			return { params: { lang, slug: slug.join("/") || undefined }, props: entry };
		})
		.filter((entry) => entry.params.lang === "en");
}

const entry = Astro.props;
const { Content } = await entry.render();

const seo: AstroSeoProps = {
	title: `${entry.data.title} - Arbor Summer College`,
	description: entry.data.shortDescription,
	canonical: `https://summercampcomingsoon.com/branches/${entry.slug}/`,
	openGraph: {
		url: entry.slug,
		title: entry.data.title,
		description: entry.data.shortDescription,
		images: [
			{
				url: "https://summercampcomingsoon.com/opengraph/social-og.jpg",
				width: 1200,
				height: 630,
				alt: "Social open graph",
				type: "image/jpeg",
			},
		],
		site_name: "Arbor Summer College",
	},
};
---

<BaseLayout seo={seo}>
	<article class="mx-auto max-w-6xl px-4 py-16 sm:px-10 lg:px-16 mt-10">
		<div class="mb-12">
			<Image 
				src={entry.data.pageImage?.source || entry.data.coverImage.source} 
				alt={entry.data.pageImage?.alt || entry.data.coverImage.alt}
				style={{ objectPosition: entry.data.pageImage?.position || entry.data.coverImage.position || 'center'}}
				class="w-full h-[40vh] object-cover rounded-xl" 
			/>
		</div>

		<div class="grid grid-cols-1 lg:grid-cols-5 gap-12">
			<div class="lg:col-span-3">
				<h1 class="text-4xl font-bold mb-6">{entry.data.title}</h1>
				<div class="prose prose-lg max-w-none">
					<Content />
				</div>
				
				<BranchSchedule schedule={entry.data.schedule} />
			</div>

			<div class="lg:col-span-2">
				<div class="bg-slate-50 p-6 rounded-xl sticky top-8 shadow-sm border border-slate-100"> 
					<div class="mb-6 flex items-center gap-4">
						<Image 
							src={entry.data.instructor.image.source} 
							alt={entry.data.instructor.image.alt}
							class="h-auto max-w-[100px] rounded object-contain" 
						/>
						<div>
							<h3 class="font-medium">Instructor</h3>
							<p class="text-lg font-bold">{entry.data.instructor.name}</p>
						</div>
					</div>

					<div class="mb-6">
						<h3 class="font-medium mb-1">Dates</h3>
						<p class="text-lg">{entry.data.dates}</p>
					</div>

					<div class="mb-6">
						<h3 class="font-medium mb-1">Cost</h3>
						<p class="text-2xl font-bold">{entry.data.cost}</p>
					</div>

					{entry.data.sponsor && (
						<div class="mb-6">
							<h3 class="font-medium mb-1">Sponsored by</h3>
							{entry.data.sponsor.link ? (
								<a href={entry.data.sponsor.link} class="text-primary-600 hover:text-primary-800">
									{entry.data.sponsor.name}
								</a>
							) : (
								<p>{entry.data.sponsor.name}</p>
							)}
						</div>
					)}

					{!entry.data.sponsor && (
						<div class="mb-6">
							<h3 class="font-medium mb-1">Sponsorship</h3>
							<a href="/contact" class="text-primary-600 hover:text-primary-800">
								Sponsor this branch!
							</a>
						</div>
					)}

					{entry.data.purchaseLink && (
						<a 
							href={entry.data.purchaseLink} 
							class="block w-full py-3 px-4 bg-campfire-500 hover:bg-campfire-600 text-white text-center font-bold rounded-lg transition-colors"
							target="_blank"
							rel="noopener noreferrer"
						>
							{entry.data.cost === "By application" ? "Apply Now" : "Register Now"}
						</a>
					)}
				</div>
			</div>
		</div>
	</article>
</BaseLayout> 